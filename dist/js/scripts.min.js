/*
 Noahdecoco 2016-03-27 
*/
function Event(a){this._sender=a,this._listeners=[]}function ListModel(a){this._items=a,this._selectedIndex=-1,this.itemAdded=new Event(this),this.itemRemoved=new Event(this),this.selectedIndexChanged=new Event(this)}function ListView(a,b){this._model=a,this._elements=b;var c=this;this._model.itemAdded.attach(function(){c.rebuildList()}),this._model.itemRemoved.attach(function(){c.rebuildList()}),this.listModified=new Event(this),this._elements.list.change(function(a){c.listModified.notify({index:a.target.selectedIndex})}),this.addButtonClicked=new Event(this),this._elements.addButton.click(function(){c.addButtonClicked.notify()}),this.delButtonClicked=new Event(this),this._elements.delButton.click(function(){c.delButtonClicked.notify()})}function ListController(a,b){this._model=a,this._view=b;var c=this;this._view.listModified.attach(function(a,b){c.updateSelected(b.index)}),this._view.addButtonClicked.attach(function(){c.addItem()}),this._view.delButtonClicked.attach(function(){c.delItem()})}var Noix={version:1};Noix.Event=function(a){var b=this;b.sender=a,b.listeners=[];var c=function(a){b.listeners.push(a)},d=function(a){for(var c=0;c<b.listeners.length;c++)b.listeners[c](b.sender,a)};return{attachListener:c,notifyListener:d}},Noix.Model=function(a){var b=this;b.data=a,b.itemAdded=new Noix.Event(b);var c=function(){return[].concat(b.data)},d=function(){b.data.push(a),b.itemAdded.notify({data:a})};return{getData:c,addData:d}},Noix.View=function(a,b){var c=this;c.model=a,c.elements=b,c.listModified=new Noix.Event(c),c.addButtonClicked=new Noix.Event(c),c.delButtonClicked=new Noix.Event(c);var d=function(){c.elements.innerHTML="";for(var a=0;a<c.model.getData().length;a++){var b=document.createElement("li");b.innerHTML=c.model.getData()[a],c.elements.appendChild(b)}},e=function(a){console.log("Register button",a),c[a.eventName]=new Event(c),a.control.addEventListener("click",a.eventCallback)};return{render:d,registerControl:e}},Noix.Controller=function(a,b){var c=this;c.model=a,c.view=b;var d=function(){c.view.render()};return{renderView:d}},Event.prototype={attach:function(a){this._listeners.push(a)},notify:function(a){var b;for(b=0;b<this._listeners.length;b+=1)this._listeners[b](this._sender,a)}},ListModel.prototype={getItems:function(){return[].concat(this._items)},addItem:function(a){this._items.push(a),this.itemAdded.notify({item:a})},removeItemAt:function(a){var b;b=this._items[a],this._items.splice(a,1),this.itemRemoved.notify({item:b}),a===this._selectedIndex&&this.setSelectedIndex(-1)},getSelectedIndex:function(){return this._selectedIndex},setSelectedIndex:function(a){var b;b=this._selectedIndex,this._selectedIndex=a,this.selectedIndexChanged.notify({previous:b})}},ListView.prototype={show:function(){this.rebuildList()},rebuildList:function(){var a,b,c;a=this._elements.list,a.html(""),b=this._model.getItems();for(c in b)b.hasOwnProperty(c)&&a.append($("<option>"+b[c]+"</option>"));this._model.setSelectedIndex(-1)}},ListController.prototype={addItem:function(){var a=window.prompt("Add item:","");a&&this._model.addItem(a)},delItem:function(){var a;a=this._model.getSelectedIndex(),-1!==a&&this._model.removeItemAt(this._model.getSelectedIndex())},updateSelected:function(a){this._model.setSelectedIndex(a)}};var todoList=document.getElementById("todo-list"),data=["Make a todo list","Learn the MVC pattern"],model=new Noix.Model(data),view=new Noix.View(model,todoList);view.registerControl({control:document.getElementById("add-item"),eventName:"addButtonClicked",eventCallback:function(){console.log("The add button was clicked")}}),view.registerControl({control:document.getElementById("del-item"),eventName:"addButtonClicked",eventCallback:function(){console.log("The delete button was clicked")}});var controller=Noix.Controller(model,view);controller.renderView(),console.log(model.getData());